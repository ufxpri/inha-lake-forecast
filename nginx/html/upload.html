<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì‚¬ì§„ ì—…ë¡œë“œ - ì¸ê²½í˜¸ ì–¸ì œ ì˜ˆë»?</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- HTMX via CDN -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <style>
        /* ê¸°ë³¸ ì„¤ì • */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #F7F8FA;
            color: #333;
            display: flex;
            justify-content: center;
        }

        .mobile-wrapper {
            width: 100%;
            max-width: 480px;
            background-color: #fff;
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px;
            position: relative;
        }

        /* ê³µí†µ ìœ í‹¸ë¦¬í‹° */
        .highlight-blue {
            color: #3D6AFE;
            font-weight: 700;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ í—¤ë” */
        .nav-header {
            height: 50px;
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .back-btn {
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
        }

        /* íƒ€ì´í‹€ ì„¹ì…˜ */
        .page-title-section {
            margin-bottom: 30px;
        }

        .page-title-section h2 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #333;
        }

        .page-title-section p {
            font-size: 14px;
            color: #888;
        }

        /* ì—…ë¡œë“œ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .upload-box-container {
            width: 100%;
            height: 200px;
            background-color: #F8F9FA;
            border: 1px solid #E0E0E0;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            margin-bottom: 40px;
            cursor: pointer;
        }

        .upload-box-container input[type="file"] {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 10;
        }

        .plus-icon {
            font-size: 40px;
            color: #BDBDBD;
            border: 2px solid #BDBDBD;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-bottom: 4px;
        }

        .preview-img {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        /* ì…ë ¥ ê·¸ë£¹ ê³µí†µ */
        .input-group {
            margin-bottom: 40px;
        }

        .input-label {
            display: block;
            font-size: 16px;
            margin-bottom: 15px;
            font-weight: 500;
        }

        /* ë‚ ì§œ ì…ë ¥ */
        .date-inputs {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .input-box {
            height: 50px;
            background: #fff;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            padding: 0 10px;
            font-size: 14px;
            text-align: center;
            outline: none;
        }

        .input-box:focus, .text-area-box:focus {
            border-color: #3D6AFE;
        }

        .input-box.year { width: 32%; }
        .input-box.month { width: 28%; }
        .input-box.day { width: 28%; }

        .dash { color: #ccc; }

        /* í…ìŠ¤íŠ¸ ì˜ì—­ */
        .text-area-box {
            width: 100%;
            height: 120px;
            background: #F8F9FA;
            border: 1px solid #E0E0E0;
            border-radius: 12px;
            padding: 15px;
            font-size: 14px;
            resize: none;
            outline: none;
            font-family: 'Noto Sans KR', sans-serif;
        }

        /* ì ìˆ˜ í‰ê°€ UI */
        .rating-container {
            position: relative;
            padding: 10px 0 30px 0;
        }

        .rating-line {
            position: absolute;
            top: 25px;
            left: 0;
            width: 100%;
            height: 1px;
            border-top: 2px dotted #ddd;
            z-index: 0;
        }

        .rating-buttons {
            display: flex;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }

        .rate-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            position: relative;
        }

        .circle-btn {
            width: 50px;
            height: 50px;
            background-color: #fff;
            border: 1px solid #E0E0E0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #ccc;
            transition: all 0.2s;
        }

        .circle-btn.active {
            border-color: #3D6AFE;
            color: #3D6AFE;
            font-weight: 700;
            background-color: #fff;
            box-shadow: 0 0 0 2px rgba(61, 106, 254, 0.1);
        }

        .rate-text {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
            position: absolute;
            top: 50px;
            white-space: nowrap;
        }

        /* í•˜ë‹¨ ê³ ì • ë²„íŠ¼ */
        .fixed-bottom-btn-wrapper {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(to top, white 70%, transparent);
            pointer-events: none;
        }

        .upload-btn {
            pointer-events: auto;
            width: 100%;
            max-width: 440px;
            height: 56px;
            background-color: #3D6AFE;
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(61, 106, 254, 0.3);
            cursor: pointer;
        }

        .upload-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .upload-btn .icon {
            margin-right: 8px;
        }

        /* HTMX ìƒíƒœ í‘œì‹œ */
        .htmx-indicator {
            display: none;
        }

        .htmx-request .htmx-indicator {
            display: block;
        }

        .upload-success {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #c3e6cb;
        }

        .upload-error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #f5c6cb;
        }

        .spacer {
            height: 20px;
        }
    </style>
</head>
<body>

    <div class="mobile-wrapper">
        
        <header class="nav-header">
            <button class="back-btn" onclick="window.location.href='index.html'">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 19L8 12L15 5" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </header>

        <div class="page-title-section">
            <h2>ì§ì ‘ ì°ì€ ì¸ê²½í˜¸ ì‚¬ì§„ì„ ì˜¬ë ¤ ì£¼ì„¸ìš”!</h2>
            <p>ì—…ë¡œë“œí•œ ì‚¬ì§„ì€ ì •í™•í•œ ì˜ˆì¸¡ì— ë°˜ì˜ë¼ìš”</p>
        </div>

        <form 
            id="upload-form"
            hx-post="http://localhost:8000/upload/image" 
            hx-encoding="multipart/form-data"
            hx-target="#upload-result"
            hx-swap="innerHTML"
            hx-indicator="#upload-progress"
        >
            
            <div class="upload-box-container" id="drop-area">
                <input type="file" name="file" id="fileElem" accept="image/*" onchange="handleFiles(this.files)" required>
                <div class="upload-placeholder" id="upload-placeholder">
                    <div class="plus-icon">+</div>
                </div>
                <img id="preview-img" class="preview-img" src="" alt="ë¯¸ë¦¬ë³´ê¸°">
            </div>

            <div class="input-group">
                <label class="input-label">ì‚¬ì§„ì„ <span class="highlight-blue">ì°ì€ ë‚ ì§œ</span>ë¥¼ ì•Œë ¤ ì£¼ì„¸ìš”</label>
                <div class="date-inputs">
                    <input type="number" name="year" placeholder="YYYY ë…„" class="input-box year" min="2020" max="2030" required>
                    <span class="dash">-</span>
                    <input type="number" name="month" placeholder="MM ì›”" class="input-box month" min="1" max="12" required>
                    <span class="dash">-</span>
                    <input type="number" name="day" placeholder="DD ì¼" class="input-box day" min="1" max="31" required>
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">ì‚¬ì§„ì— ëŒ€í•œ <span class="highlight-blue">ì§§ì€ ê°ìƒ</span>ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”</label>
                <textarea name="description" class="text-area-box" placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”" required></textarea>
            </div>

            <div class="input-group">
                <label class="input-label">ì‚¬ì§„ì— ëŒ€í•œ <span class="highlight-blue">ì ìˆ˜ë¥¼ í‰ê°€</span>í•´ ì£¼ì„¸ìš”</label>
                
                <div class="rating-container">
                    <div class="rating-line"></div>
                    
                    <div class="rating-buttons">
                        <div class="rate-item" onclick="selectRating(1)">
                            <div class="circle-btn" id="rate-1">1</div>
                            <span class="rate-text">ë³„ë¡œì˜ˆìš”</span>
                        </div>
                        <div class="rate-item" onclick="selectRating(2)">
                            <div class="circle-btn" id="rate-2">2</div>
                        </div>
                        <div class="rate-item" onclick="selectRating(3)">
                            <div class="circle-btn" id="rate-3">3</div>
                            <span class="rate-text">ë³´í†µì´ì—ìš”</span>
                        </div>
                        <div class="rate-item" onclick="selectRating(4)">
                            <div class="circle-btn" id="rate-4">4</div>
                        </div>
                        <div class="rate-item" onclick="selectRating(5)">
                            <div class="circle-btn" id="rate-5">5</div>
                            <span class="rate-text">ìµœê³ ì˜ˆìš”</span>
                        </div>
                    </div>
                </div>
                <input type="hidden" name="rating" id="rating-value" required>
            </div>

        </form>

        <!-- Upload Progress Indicator -->
        <div id="upload-progress" class="htmx-indicator">
            <div style="background-color: #e3f2fd; border: 1px solid #bbdefb; border-radius: 8px; padding: 15px; text-align: center;">
                <div style="color: #1976d2; font-weight: 500;">ğŸ“¤ ì—…ë¡œë“œ ì¤‘...</div>
                <div style="color: #666; font-size: 14px; margin-top: 5px;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”</div>
            </div>
        </div>

        <!-- Upload Result -->
        <div id="upload-result"></div>

        <div class="spacer"></div>
        <div class="fixed-bottom-btn-wrapper">
            <button type="submit" form="upload-form" class="upload-btn" id="submit-btn" disabled>
                <span class="icon">ğŸ“¤</span> ì¸ê²½í˜¸ ì‚¬ì§„ ì—…ë¡œë“œí•˜ê¸°
            </button>
        </div>

    </div>

    <script>
        let selectedRating = null;

        // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥
        function handleFiles(files) {
            const file = files[0];
            const preview = document.getElementById('preview-img');
            const placeholder = document.getElementById('upload-placeholder');

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    placeholder.style.display = 'none';
                }
                reader.readAsDataURL(file);
                checkFormValidity();
            }
        }

        // ì ìˆ˜ ì„ íƒ ê¸°ëŠ¥
        function selectRating(score) {
            // ëª¨ë“  ë²„íŠ¼ ì´ˆê¸°í™”
            for (let i = 1; i <= 5; i++) {
                const btn = document.getElementById(`rate-${i}`);
                btn.classList.remove('active');
            }

            // ì„ íƒí•œ ë²„íŠ¼ í™œì„±í™”
            const selectedBtn = document.getElementById(`rate-${score}`);
            selectedBtn.classList.add('active');
            
            // ìˆ¨ê²¨ì§„ inputì— ê°’ ì„¤ì •
            document.getElementById('rating-value').value = score;
            selectedRating = score;
            
            checkFormValidity();
            console.log(`ì„ íƒëœ ì ìˆ˜: ${score}`);
        }

        // í¼ ìœ íš¨ì„± ê²€ì‚¬
        function checkFormValidity() {
            const fileInput = document.getElementById('fileElem');
            const yearInput = document.querySelector('input[name="year"]');
            const monthInput = document.querySelector('input[name="month"]');
            const dayInput = document.querySelector('input[name="day"]');
            const descriptionInput = document.querySelector('textarea[name="description"]');
            const submitBtn = document.getElementById('submit-btn');

            const isValid = fileInput.files.length > 0 && 
                           yearInput.value && 
                           monthInput.value && 
                           dayInput.value && 
                           descriptionInput.value.trim() && 
                           selectedRating;

            submitBtn.disabled = !isValid;
        }

        // ì…ë ¥ í•„ë“œ ë³€ê²½ ê°ì§€
        document.addEventListener('input', checkFormValidity);

        // HTMX ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.body.addEventListener('htmx:afterRequest', function(evt) {
            if (evt.detail.successful) {
                // ì„±ê³µ ì‹œ í¼ ë¦¬ì…‹
                document.getElementById('upload-form').reset();
                document.getElementById('preview-img').style.display = 'none';
                document.getElementById('upload-placeholder').style.display = 'flex';
                
                // ì ìˆ˜ ë²„íŠ¼ ë¦¬ì…‹
                for (let i = 1; i <= 5; i++) {
                    document.getElementById(`rate-${i}`).classList.remove('active');
                }
                selectedRating = null;
                checkFormValidity();
            }
        });

        // ì´ˆê¸° í¼ ìƒíƒœ ì„¤ì •
        checkFormValidity();
    </script>

</body>
</html>