{% extends "base.html" %}

{% block title %}ì¸ê²½í˜¸ ë‚ ì”¨ ì •ë³´ - HTMX{% endblock %}

{% block content %}
<!-- Weather Dashboard Container -->
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 lg:py-12 max-w-7xl">
    
    <!-- Header -->
    <header class="text-center mb-8 sm:mb-12">
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-800 mb-2 sm:mb-3">
            ğŸŒ¤ï¸ ì¸ê²½í˜¸ ë‚ ì”¨ ì •ë³´
        </h1>
        <p class="text-base sm:text-lg text-gray-600">ì‹¤ì‹œê°„ ë‚ ì”¨ì™€ ìµœì  ë°©ë¬¸ ì‹œê°„</p>
    </header>
    
    <!-- Weather Components Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        
        <!-- Hero Component - Current Weather -->
        <div class="lg:col-span-1">
            <div 
                id="weather-hero"
                hx-get="/weather/hero" 
                hx-trigger="load"
                hx-swap="innerHTML"
            >
                <!-- Loading state -->
                <div class="bg-gray-200 animate-pulse rounded-xl p-6 h-48">
                    <div class="h-4 bg-gray-300 rounded w-1/2 mb-4"></div>
                    <div class="h-8 bg-gray-300 rounded w-3/4 mb-2"></div>
                    <div class="h-4 bg-gray-300 rounded w-1/3"></div>
                </div>
            </div>
        </div>
        
        <!-- Today Component - Best Time Today -->
        <div class="lg:col-span-1">
            <div 
                id="weather-today"
                hx-get="/weather/today" 
                hx-trigger="load"
                hx-swap="innerHTML"
            >
                <!-- Loading state -->
                <div class="bg-gray-200 animate-pulse rounded-xl p-6 h-48">
                    <div class="h-4 bg-gray-300 rounded w-2/3 mb-4"></div>
                    <div class="h-8 bg-gray-300 rounded w-1/2 mb-2"></div>
                    <div class="h-4 bg-gray-300 rounded w-1/4"></div>
                </div>
            </div>
        </div>
        
        <!-- Week Component - Best Day This Week -->
        <div class="lg:col-span-1">
            <div 
                id="weather-week"
                hx-get="/weather/week" 
                hx-trigger="load"
                hx-swap="innerHTML"
            >
                <!-- Loading state -->
                <div class="bg-gray-200 animate-pulse rounded-xl p-6 h-48">
                    <div class="h-4 bg-gray-300 rounded w-2/3 mb-4"></div>
                    <div class="h-8 bg-gray-300 rounded w-3/4 mb-2"></div>
                    <div class="h-4 bg-gray-300 rounded w-1/3"></div>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- Refresh All Button -->
    <div class="text-center mb-8">
        <button 
            class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-full font-semibold shadow-lg transition transform hover:scale-105"
            hx-get="/weather/hero" 
            hx-target="#weather-hero"
            hx-swap="innerHTML"
        >
            ğŸ”„ ëª¨ë“  ë‚ ì”¨ ì •ë³´ ìƒˆë¡œê³ ì¹¨
        </button>
        <button 
            class="ml-4 bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-full font-semibold shadow-lg transition transform hover:scale-105"
            hx-get="/weather/today" 
            hx-target="#weather-today"
            hx-swap="innerHTML"
        >
            â­ ì˜¤ëŠ˜ ë² ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
        </button>
        <button 
            class="ml-4 bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-full font-semibold shadow-lg transition transform hover:scale-105"
            hx-get="/weather/week" 
            hx-target="#weather-week"
            hx-swap="innerHTML"
        >
            ğŸ† ì£¼ê°„ ë² ìŠ¤íŠ¸ ìƒˆë¡œê³ ì¹¨
        </button>
    </div>
    
    <!-- Navigation Back to Main -->
    <div class="text-center">
        <a 
            href="/" 
            class="inline-block bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-full font-semibold transition"
        >
            â† ë©”ì¸ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
        </a>
    </div>
    
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // HTMX event listeners for weather components
    document.body.addEventListener('htmx:beforeSwap', function(evt) {
        // Add fade effect before content swap for weather components
        if (evt.detail.target.id.startsWith('weather-')) {
            evt.detail.target.style.opacity = '0.7';
        }
    });
    
    document.body.addEventListener('htmx:afterSwap', function(evt) {
        // Restore opacity after content swap
        if (evt.detail.target.id.startsWith('weather-')) {
            evt.detail.target.style.opacity = '1';
        }
    });
    
    // Log weather updates for debugging
    document.body.addEventListener('htmx:afterRequest', function(evt) {
        if (evt.detail.pathInfo.requestPath.startsWith('/weather/')) {
            console.log('Weather component updated:', evt.detail.pathInfo.requestPath, 'at:', new Date().toLocaleTimeString());
        }
    });
    
    // Global refresh function
    function refreshAllWeather() {
        htmx.trigger('#weather-hero', 'refresh');
        htmx.trigger('#weather-today', 'refresh');
        htmx.trigger('#weather-week', 'refresh');
    }
    
    // Auto-refresh all components every 15 minutes
    setInterval(refreshAllWeather, 900000);
</script>
{% endblock %}